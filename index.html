<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes, viewport-fit=cover">
    <title>‚ú® Ramadan Legacy Quest - Enchanted Family Edition ‚ú®</title>
    
    <!-- Font Awesome 6 (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* =====================================
           RAMADAN LEGACY QUEST - STYLE.CSS
           Light Mode: Beige, Green, Brown
           Dark Mode: Deep Blue & Gold
           Responsive for all devices
           ===================================== */

        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', 'Georgia', sans-serif;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }

        body {
            min-height: 100vh;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* ===== LIGHT MODE (Beige, Green, Brown) ===== */
        body.light-mode {
            background: #f7f1e0;
            background-image: radial-gradient(circle at 10% 30%, rgba(159, 188, 118, 0.1) 0%, transparent 25%),
                              radial-gradient(circle at 90% 70%, rgba(180, 150, 100, 0.08) 0%, transparent 30%);
            color: #3e3e2b;
        }

        body.light-mode .container {
            background: rgba(255, 251, 240, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid #d6c29d;
            box-shadow: 0 15px 30px rgba(110, 80, 50, 0.15);
        }

        body.light-mode .card {
            background: rgba(255, 248, 230, 0.8);
            border: 1px solid #cfbc93;
            box-shadow: 0 8px 16px rgba(130, 100, 70, 0.1);
        }

        body.light-mode h1 {
            color: #5f7a4a;
            text-shadow: 2px 2px 0 #e6dcc0;
        }

        body.light-mode .subtitle {
            color: #9b7e5c;
        }

        body.light-mode button {
            background: linear-gradient(to bottom, #a3c293, #7e9f6f);
            color: white;
            border: 1px solid #6b8c4e;
            box-shadow: 0 5px 0 #5a6e4a;
        }

        body.light-mode button:hover {
            background: linear-gradient(to bottom, #b2d3a1, #8aad7a);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #5a6e4a;
        }

        body.light-mode button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #5a6e4a;
        }

        body.light-mode .moon-day {
            background: #e5d9bf;
            border: 2px solid #c4aa7b;
            color: #5a4a38;
        }

        body.light-mode .moon-day.current {
            background: #fdde8c;
            border-color: #d4a017;
            color: #3e2e1e;
        }

        body.light-mode .moon-day.completed {
            background: #9bb87a;
            border-color: #6b8c4e;
            color: white;
        }

        body.light-mode .family-code-section {
            background: rgba(200, 180, 140, 0.2);
            border: 2px dashed #b39b6b;
        }

        body.light-mode .code-display {
            background: #7e9f6f;
            color: white;
        }

        /* ===== DARK MODE (Deep Blue & Gold) ===== */
        body.dark-mode {
            background: #0b1a2e;
            background-image: radial-gradient(circle at 20% 40%, rgba(255, 215, 0, 0.08) 0%, transparent 30%),
                              radial-gradient(circle at 80% 80%, rgba(200, 170, 50, 0.06) 0%, transparent 40%);
            color: #f5e7d3;
        }

        body.dark-mode .container {
            background: rgba(10, 25, 40, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid #c9a03d;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.6);
        }

        body.dark-mode .card {
            background: rgba(20, 40, 55, 0.85);
            border: 1px solid #b38f40;
        }

        body.dark-mode h1 {
            color: #f5d742;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        body.dark-mode .subtitle {
            color: #e6c87c;
        }

        body.dark-mode button {
            background: linear-gradient(to bottom, #1e3a5a, #0e2a44);
            color: #ffecb3;
            border: 1px solid #f5d742;
            box-shadow: 0 5px 0 #0a1a2e, 0 0 10px rgba(255, 215, 0, 0.2);
        }

        body.dark-mode button:hover {
            background: linear-gradient(to bottom, #2a4a6a, #1a3a54);
            border-color: #ffd700;
            box-shadow: 0 7px 0 #0a1a2e, 0 0 15px rgba(255, 215, 0, 0.4);
        }

        body.dark-mode .moon-day {
            background: #1e3a5a;
            border: 2px solid #b38f40;
            color: #f5e7b3;
        }

        body.dark-mode .moon-day.current {
            background: #f5d742;
            border-color: #ffd700;
            color: #0a1a2e;
        }

        body.dark-mode .moon-day.completed {
            background: #2a5a5a;
            border-color: #c9a03d;
            color: #ffecb3;
        }

        body.dark-mode select,
        body.dark-mode input {
            background: #1e3a5a;
            border-color: #b38f40;
            color: #f5e7d3;
        }

        body.dark-mode .player {
            background: rgba(30, 58, 90, 0.7);
            border-left: 6px solid #f5d742;
        }

        body.dark-mode .family-code-section {
            background: rgba(30, 58, 90, 0.5);
            border: 2px dashed #c9a03d;
        }

        body.dark-mode .code-display {
            background: #0e2a44;
            color: #ffd700;
            border-color: #ffd700;
        }

        body.dark-mode .points-display {
            background: linear-gradient(145deg, #1e3a5a, #0e2a44);
            border: 1px solid #f5d742;
        }

        body.dark-mode .dice-result {
            background: rgba(30, 58, 90, 0.6);
            border-color: #c9a03d;
            color: #f5e7d3;
        }

        body.dark-mode .log {
            background: rgba(10, 30, 45, 0.8);
        }

        body.dark-mode .mosque-decoration {
            background: repeating-linear-gradient(90deg, 
                transparent, 
                transparent 60px,
                rgba(230, 200, 120, 0.1) 60px,
                rgba(230, 200, 120, 0.1) 120px);
        }

        body.dark-mode .lantern {
            color: rgba(255, 215, 0, 0.6);
            filter: drop-shadow(0 0 8px gold);
        }

        body.dark-mode .star {
            color: rgba(255, 223, 0, 0.7);
        }

        body.dark-mode .moon-fixed {
            color: rgba(255, 223, 0, 0.7);
            text-shadow: 0 0 15px gold;
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            width: 100%;
            max-width: 1300px;
            border-radius: 50px 50px 30px 30px;
            padding: 30px 25px;
            position: relative;
            z-index: 20;
        }

        /* ===== RAMADAN DECORATIONS ===== */
        .mosque-decoration {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            background: repeating-linear-gradient(90deg, 
                transparent, 
                transparent 60px,
                rgba(95, 138, 75, 0.1) 60px,
                rgba(95, 138, 75, 0.1) 120px);
            mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,120 L100,40 L200,80 L300,20 L400,60 L500,30 L600,70 L700,20 L800,50 L900,10 L1000,60 L1100,30 L1200,80 L1200,120 Z" fill="black"/></svg>');
            mask-size: 300px 120px;
            mask-repeat: repeat-x;
            pointer-events: none;
            z-index: 5;
        }

        .lanterns {
            position: fixed;
            top: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
            z-index: 10;
        }

        .lantern {
            font-size: 3rem;
            color: rgba(180, 150, 80, 0.4);
            filter: drop-shadow(0 0 5px rgba(255, 200, 0, 0.3));
        }

        .stars-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            color: rgba(255, 215, 0, 0.2);
            font-size: 1.2rem;
        }

        .moon-fixed {
            position: fixed;
            top: 30px;
            right: 40px;
            font-size: 3rem;
            color: rgba(200, 180, 100, 0.3);
            z-index: 15;
            pointer-events: none;
        }

        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f0e6d2;
            border: 2px solid #b39b6b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #5a4a38;
        }

        /* ===== FAMILY CODE SECTION ===== */
        .family-code-section {
            border-radius: 80px;
            padding: 25px 20px;
            margin: 25px 0 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .family-code-input {
            padding: 16px 24px;
            border-radius: 60px;
            border: 2px solid;
            font-size: 1rem;
            width: 220px;
            background: white;
        }

        .code-display {
            padding: 12px 28px;
            border-radius: 60px;
            font-weight: bold;
            letter-spacing: 3px;
            font-size: 1.3rem;
            border: 2px solid;
        }

        /* ===== MOON TRACKER ===== */
        .moon-tracker {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }

        .moon-day {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        /* ===== POINTS DISPLAY ===== */
        .points-display {
            background: linear-gradient(145deg, #7e9f6f, #5f7a4a);
            border-radius: 80px;
            padding: 25px;
            text-align: center;
            color: white;
            margin: 25px 0;
        }

        /* ===== GAME GRID ===== */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 28px;
            margin: 30px 0;
        }

        /* ===== CARDS ===== */
        .card {
            border-radius: 40px 40px 25px 25px;
            padding: 28px 22px;
            backdrop-filter: blur(4px);
        }

        .card h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px dashed rgba(180, 150, 80, 0.4);
            padding-bottom: 12px;
        }

        /* ===== FORM ELEMENTS ===== */
        select, input {
            padding: 16px 20px;
            border-radius: 60px;
            border: 2px solid;
            width: 100%;
            margin: 8px 0 16px;
            font-size: 1rem;
            background: white;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        /* ===== BUTTONS ===== */
        button {
            padding: 14px 24px;
            border: none;
            border-radius: 60px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.1s ease;
        }

        /* ===== PLAYER LIST ===== */
        .player-list {
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            margin: 12px 0;
            border-radius: 20px;
            border-left: 6px solid #7e9f6f;
            background: rgba(126, 159, 111, 0.1);
        }

        .player-points {
            font-size: 1.8rem;
            font-weight: bold;
            background: rgba(255, 215, 0, 0.2);
            padding: 5px 16px;
            border-radius: 50px;
        }

        /* ===== DICE RESULT ===== */
        .dice-result {
            padding: 25px;
            border-radius: 30px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed;
            min-height: 130px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(255, 248, 210, 0.3);
        }

        /* ===== LOG SECTION ===== */
        .log {
            max-height: 220px;
            overflow-y: auto;
            padding: 18px;
            border-radius: 25px;
            background: rgba(200, 180, 140, 0.1);
            margin-top: 15px;
        }

        .log-entry {
            padding: 12px;
            border-bottom: 1px solid rgba(130, 100, 70, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ===== CELEBRATION MODAL ===== */
        .celebration-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff9e6;
            padding: 40px;
            border-radius: 80px 80px 40px 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            border: 5px solid #d4af37;
            min-width: 350px;
            display: none;
        }

        body.dark-mode .celebration-modal {
            background: #0e2a44;
            border-color: #ffd700;
            color: #ffecb3;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            display: none;
        }

        /* ===== CONFETTI ===== */
        .confetti-piece {
            position: fixed;
            width: 14px;
            height: 14px;
            background: #f5d742;
            opacity: 0.8;
            pointer-events: none;
            z-index: 10001;
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(120vh) rotate(720deg); opacity: 0; }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container { padding: 20px 15px; }
            h1 { font-size: 1.8rem; }
            .moon-day { width: 42px; height: 42px; font-size: 1rem; }
            .family-code-section { flex-direction: column; }
            .theme-toggle { width: 50px; height: 50px; font-size: 1.5rem; }
            .lanterns { display: none; }
            .moon-fixed { font-size: 2rem; top: 70px; }
        }

        @media (max-width: 480px) {
            .game-grid { grid-template-columns: 1fr; }
            button { width: 100%; }
            .code-display { font-size: 1rem; padding: 10px 16px; }
            .celebration-modal { min-width: 280px; padding: 25px; }
        }

        @media (min-width: 768px) and (max-width: 1024px) {
            .container { max-width: 900px; }
            .game-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* ===== 1100 POINT GOAL SYSTEM STYLES ===== */
        .treat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 50px;
            border-left: 4px solid #d4af37;
            font-size: 0.95rem;
        }

        .treat-item:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateX(5px);
        }

        #goalProgressFill {
            position: relative;
            overflow: hidden;
        }

        #goalProgressFill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0.3) 50%,
                rgba(255,255,255,0.1) 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #goalCelebration {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Dark mode adjustments */
        body.dark-mode .treat-item {
            background: rgba(212, 175, 55, 0.15);
            border-left-color: #f5d742;
        }

        body.dark-mode #treatList {
            background: rgba(30, 58, 90, 0.5);
        }

        /* ===== DAILY CHECK-IN SECTION STYLES ===== */
        #morningCheckInList div, #eveningCheckInList div {
            display: inline-block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        textarea#reflectionInput {
            resize: vertical;
            min-height: 100px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        textarea#reflectionInput:focus {
            border-color: #d4af37 !important;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            outline: none;
        }

        #reflectionsList {
            scrollbar-width: thin;
            scrollbar-color: #d4af37 rgba(212, 175, 55, 0.1);
        }

        #reflectionsList::-webkit-scrollbar {
            width: 6px;
        }

        #reflectionsList::-webkit-scrollbar-track {
            background: rgba(212, 175, 55, 0.1);
            border-radius: 10px;
        }

        #reflectionsList::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 10px;
        }

        /* Dark mode scrollbar */
        body.dark-mode #reflectionsList::-webkit-scrollbar-track {
            background: rgba(30, 58, 90, 0.5);
        }

        body.dark-mode #reflectionsList::-webkit-scrollbar-thumb {
            background: #f5d742;
        }

        /* ===== ROLES SECTION STYLES ===== */
        .roles-card {
            background: linear-gradient(145deg, rgba(126,159,111,0.15), rgba(180,150,80,0.15));
            border: 2px solid #d4af37;
            border-radius: 20px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .roles-header {
            cursor: pointer;
            user-select: none;
            padding: 15px 20px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 20px 20px 0 0;
        }

        .roles-header h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 !important;
            border-bottom: none !important;
            color: #d4af37;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s;
            display: inline-block;
        }

        .roles-content {
            padding: 20px;
        }

        .role-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border-left: 5px solid #d4af37;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .role-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
        }

        .role-icon {
            font-size: 3rem;
            min-width: 80px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-info {
            flex: 1;
        }

        .role-info h4 {
            color: #d4af37;
            margin-bottom: 8px;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .role-desc {
            color: #5f4c3b;
            font-size: 1rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .role-bonus {
            background: rgba(212, 175, 55, 0.15);
            padding: 10px 15px;
            border-radius: 40px;
            margin-bottom: 12px;
            display: inline-block;
            border: 1px dashed #d4af37;
        }

        .bonus-tag {
            background: #d4af37;
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-right: 12px;
            display: inline-block;
        }

        .bonus-text {
            color: #5f7a4a;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .role-special {
            font-size: 0.95rem;
            color: #7d9a6c;
            padding: 12px;
            background: rgba(125, 154, 108, 0.15);
            border-radius: 12px;
            border-left: 3px solid #7d9a6c;
        }

        .role-special strong {
            color: #5f7a4a;
        }

        .roles-footer {
            text-align: center;
            margin-top: 25px;
            padding: 20px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 15px;
            color: #5f4c3b;
            font-size: 0.95rem;
            font-style: italic;
        }

        /* ===== DARK MODE ROLE STYLES ===== */
        body.dark-mode .roles-card {
            background: linear-gradient(145deg, rgba(30, 58, 90, 0.8), rgba(20, 45, 70, 0.8));
            border-color: #ffd700;
        }

        body.dark-mode .roles-header {
            background: rgba(255, 215, 0, 0.15);
        }

        body.dark-mode .role-desc {
            color: #e6d5b8;
        }

        body.dark-mode .bonus-text {
            color: #ffecb3;
        }

        body.dark-mode .role-special {
            background: rgba(30, 58, 90, 0.8);
            color: #f5d742;
            border-left-color: #ffd700;
        }

        body.dark-mode .role-special strong {
            color: #ffd700;
        }

        body.dark-mode .roles-footer {
            background: rgba(255, 215, 0, 0.1);
            color: #e6d5b8;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .role-item {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .role-icon {
                font-size: 2.5rem;
                min-width: auto;
            }
            
            .role-bonus {
                display: block;
                text-align: center;
            }
            
            .bonus-tag {
                display: block;
                margin-right: 0;
                margin-bottom: 8px;
            }
        }

        @media (max-width: 480px) {
            .role-info h4 {
                font-size: 1.1rem;
            }
            
            .role-desc {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body class="light-mode">
    <!-- FIXED RAMADAN DECORATIONS -->
    <div class="mosque-decoration"></div>
    <div class="lanterns">
        <span class="lantern"><i class="fas fa-lantern"></i></span>
        <span class="lantern"><i class="fas fa-lantern"></i></span>
        <span class="lantern"><i class="fas fa-lantern"></i></span>
    </div>
    <div class="stars-fixed">
        <span class="star" style="top: 10%; left: 5%;"><i class="fas fa-star"></i></span>
        <span class="star" style="top: 15%; right: 10%;"><i class="fas fa-star"></i></span>
        <span class="star" style="bottom: 20%; left: 15%;"><i class="fas fa-star"></i></span>
        <span class="star" style="bottom: 10%; right: 20%;"><i class="fas fa-star"></i></span>
        <span class="star" style="top: 25%; left: 25%;"><i class="fas fa-star"></i></span>
        <span class="star" style="top: 70%; right: 15%;"><i class="fas fa-star"></i></span>
        <span class="star" style="bottom: 30%; right: 30%;"><i class="fas fa-star"></i></span>
    </div>
    <div class="moon-fixed">
        <i class="fas fa-moon"></i>
    </div>

    <!-- THEME TOGGLE BUTTON -->
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </div>

    <!-- CELEBRATION MODAL -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="celebration-modal" id="celebrationModal">
        <i class="fas fa-star" style="font-size: 3rem; color: #d4af37; margin-bottom: 10px;"></i>
        <i class="fas fa-moon" style="font-size: 2.5rem; color: #9ab87a; margin-bottom: 10px;"></i>
        <h2 id="modalTitle" style="margin-bottom: 15px;">‚ú® Mabrook! ‚ú®</h2>
        <p id="modalMessage" style="font-size: 1.3rem; margin-bottom: 25px;"></p>
        <button onclick="closeModal()" style="padding: 15px 35px;"><i class="fas fa-heart"></i> Continue</button>
    </div>

    <!-- MAIN GAME CONTAINER -->
    <div class="container">
        <header>
            <h1><i class="fas fa-mosque"></i> Ramadan Legacy Quest <i class="fas fa-moon"></i></h1>
            <p class="subtitle"><i class="fas fa-sparkle"></i> 30 Days of Blessings & Family Fun <i class="fas fa-sparkle"></i></p>

            <!-- FAMILY CODE SECTION -->
            <div class="family-code-section">
                <i class="fas fa-users" style="font-size: 2.2rem; color: #b38f40;"></i>
                <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center; justify-content: center;">
                    <input type="text" id="familyCodeInput" class="family-code-input" placeholder="Enter family code" maxlength="10">
                    <button id="joinFamilyBtn"><i class="fas fa-door-open"></i> Join Family</button>
                    <button id="createFamilyBtn" style="background: #b38f40; color: white;"><i class="fas fa-plus-circle"></i> Create</button>
                </div>
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <span style="font-weight: bold;">üè† Current Family:</span>
                    <span id="familyCodeDisplay" class="code-display">üî¥ NOT JOINED</span>
                </div>
            </div>

            <!-- MOON TRACKER -->
            <div class="moon-tracker" id="moonTracker"></div>

            <!-- POINTS DISPLAY -->
            <div class="points-display">
                <h2 id="currentDay">Day 1 of Ramadan</h2>
                <p><i class="fas fa-coins"></i> Family Fortune: <span id="totalPoints">0</span> points</p>
            </div>
        </header>

        <!-- GAME GRID - 3 CARDS -->
        <div class="game-grid">
            <!-- CARD 1: CHARACTER -->
            <div class="card">
                <h3><i class="fas fa-user-crescent"></i> 1. Choose Character</h3>
                <select id="characterSelect">
                    <option value="">-- Select Your Role --</option>
                    <option value="guardian">üõ°Ô∏è The Guardian (Family Bonus)</option>
                    <option value="seeker">üìñ The Seeker (Quran Bonus)</option>
                    <option value="nourisher">üçΩÔ∏è The Nourisher (Iftar Bonus)</option>
                    <option value="connector">ü§ù The Connector (Community)</option>
                    <option value="healer">üíö The Healer (Patience)</option>
                    <option value="illuminator">ü™î The Illuminator (Creative)</option>
                </select>
                <input type="text" id="playerName" placeholder="Your name">
                <button id="joinGameBtn"><i class="fas fa-user-plus"></i> Join Quest</button>
                <div class="player-list" id="playerList"></div>
            </div>

            <!-- CARD 2: DAILY DEVOTION -->
            <div class="card">
                <h3><i class="fas fa-tasks"></i> 2. Daily Devotion</h3>
                
                <label><i class="fas fa-utensils"></i> Fast Completed?</label>
                <select id="fastSelect">
                    <option value="0">No</option>
                    <option value="1">Yes! (+1)</option>
                </select>

                <label><i class="fas fa-book-open"></i> Quran Time</label>
                <select id="quranSelect">
                    <option value="0">0-9 min</option>
                    <option value="1">10-19 min (+1)</option>
                    <option value="2">20-29 min (+2)</option>
                    <option value="3">30+ min (+3)</option>
                </select>

                <label><i class="fas fa-mosque"></i> Daily Prayers</label>
                <select id="prayerSelect">
                    <option value="0">0</option>
                    <option value="1">1 (+1)</option>
                    <option value="2">2 (+2)</option>
                    <option value="3">3 (+3)</option>
                    <option value="4">4 (+4)</option>
                    <option value="5">5 (+5)</option>
                </select>

                <label><i class="fas fa-shield"></i> Character Mission</label>
                <select id="missionSelect">
                    <option value="0">Not completed</option>
                    <option value="2">Completed! (+2)</option>
                </select>

                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <button id="submitDailyBtn"><i class="fas fa-paper-plane"></i> Submit</button>
                    <button id="spotDeedBtn"><i class="fas fa-eye"></i> Spot Secret</button>
                </div>
            </div>

            <!-- CARD 3: DUA DICE + QUESTS -->
            <div class="card">
                <h3><i class="fas fa-dice"></i> 3. Dua Dice</h3>
                <button id="rollDiceBtn" style="font-size: 1.8rem; padding: 20px; width: 100%;">
                    <i class="fas fa-dice-d20"></i> ROLL
                </button>
                <div class="dice-result" id="diceResult">
                    ‚ú® Click ROLL for a family prompt ‚ú®
                </div>
                
                <h3 style="margin-top: 20px;"><i class="fas fa-flag"></i> 4. Weekly Quest</h3>
                <p id="currentQuest" style="padding: 16px; border-radius: 20px; background: rgba(125,154,108,0.2);">
                    üåü Week 1: 5 Ramadan traditions
                </p>
                <button id="completeQuestBtn"><i class="fas fa-check-circle"></i> Complete Quest</button>
            </div>
        </div>

        <!-- FAMILY GOAL CARD - 1100 POINTS -->
        <div class="card goal-card">
            <h3><i class="fas fa-trophy" style="color: #d4af37;"></i> FAMILY GOAL: 1100 POINTS!</h3>
            
            <div class="goal-container">
                <div class="progress-container">
                    <div class="progress-header">
                        <span>üéØ Progress:</span>
                        <span id="goalProgress">0 / 1100</span>
                    </div>
                    
                    <div class="progress-bar">
                        <div id="goalProgressFill" style="width: 0%;"></div>
                    </div>
                    
                    <div class="progress-footer">
                        <span id="goalPercentage">0%</span>
                        <span>‚ú® 1100 ‚ú®</span>
                    </div>
                    
                    <div id="goalCelebration" class="goal-celebration">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span>GOAL ACHIEVED! TIME TO CELEBRATE!</span>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                
                <div class="treats-container">
                    <h4><i class="fas fa-gift"></i> Family Treats <span id="treatCount">0</span></h4>
                    
                    <div class="add-treat">
                        <input type="text" id="treatInput" placeholder="Add a treat (e.g. Pizza party!)">
                        <button id="addTreatBtn"><i class="fas fa-plus"></i> Add</button>
                    </div>
                    
                    <div id="treatList" class="treat-list"></div>
                    
                    <button id="claimRewardBtn" class="claim-btn"><i class="fas fa-gift"></i> CLAIM A TREAT!</button>
                    <p class="treat-note"><i class="fas fa-info-circle"></i> Reach 1100 points to unlock treats!</p>
                </div>
            </div>
        </div>

        <!-- DAILY CHECK-IN & REFLECTION SECTION -->
        <div class="card checkin-card">
            <h3><i class="fas fa-calendar-check" style="color: #7d9a6c;"></i> ‚òÄÔ∏èüåô Daily Ramadan Check-In (No Points)</h3>
            
            <p class="checkin-intro">
                <i class="fas fa-heart"></i> Check in twice daily to stay connected with your family, wherever you are!
            </p>
            
            <div class="checkin-grid">
                
                <!-- MORNING CHECK-IN -->
                <div class="checkin-morning">
                    <div class="checkin-header">
                        <div class="checkin-icon morning-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div>
                            <h4>Morning Check-In</h4>
                            <p>Fajr - Start of Fast</p>
                        </div>
                    </div>
                    
                    <div class="checkin-stats">
                        <span>Today's Check-Ins:</span>
                        <span id="morningCheckInCount" class="checkin-count">0 / 0</span>
                    </div>
                    
                    <div id="morningCheckInList" class="checkin-list"></div>
                    
                    <button id="morningCheckInBtn" class="morning-btn"><i class="fas fa-sun"></i> I'm Fasting Today ‚òÄÔ∏è</button>
                    <p class="checkin-note"><i class="fas fa-info-circle"></i> Let family know you started your fast</p>
                </div>
                
                <!-- EVENING CHECK-IN -->
                <div class="checkin-evening">
                    <div class="checkin-header">
                        <div class="checkin-icon evening-icon">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div>
                            <h4>Evening Check-In</h4>
                            <p>Maghrib - Iftar Time</p>
                        </div>
                    </div>
                    
                    <div class="checkin-stats">
                        <span>Today's Check-Ins:</span>
                        <span id="eveningCheckInCount" class="checkin-count">0 / 0</span>
                    </div>
                    
                    <div id="eveningCheckInList" class="checkin-list"></div>
                    
                    <button id="eveningCheckInBtn" class="evening-btn"><i class="fas fa-moon"></i> Fast Completed üåô</button>
                    <p class="checkin-note"><i class="fas fa-info-circle"></i> Let family know your fast was accepted</p>
                </div>
                
                <!-- REFLECTION SECTION -->
                <div class="reflection-section">
                    <div class="checkin-header">
                        <div class="checkin-icon reflection-icon">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                        <div>
                            <h4>Family Reflections</h4>
                            <p>Share your Ramadan thoughts</p>
                        </div>
                    </div>
                    
                    <textarea id="reflectionInput" rows="3" placeholder="What did you learn today? What touched your heart? What dua are you making?"></textarea>
                    
                    <button id="saveReflectionBtn" class="reflection-btn"><i class="fas fa-save"></i> Share Reflection</button>
                    
                    <div class="recent-reflections">
                        <div class="reflections-header">
                            <span>üìù Recent Reflections</span>
                            <span>Last 10</span>
                        </div>
                        <div id="reflectionsList" class="reflections-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAMILY LOG CARD -->
        <div class="card">
            <h3><i class="fas fa-scroll"></i> Family Fortune Log</h3>
            <div class="log" id="familyLog"></div>
            <div class="action-buttons">
                <button id="shareGameBtn"><i class="fas fa-share-alt"></i> Share</button>
                <button id="resetDayBtn"><i class="fas fa-sun"></i> New Day</button>
                <button id="exportDataBtn"><i class="fas fa-download"></i> Save</button>
                <button id="helpBtn"><i class="fas fa-question-circle"></i> Guide</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // RAMADAN LEGACY QUEST - SIMPLIFIED SINGLE-FAMILY VERSION
        // WITH 1100 POINT GOAL, REMOTE DUA DICE & DAILY CHECK-INS
        // NO LOGIN REQUIRED
        // ============================================

        // ---------- GAME STATE ----------
        let gameState = {
            familyCode: null,
            players: [],
            currentDay: 1,
            totalPoints: 0,
            logs: [],
            weeklyQuest: 1,
            darkMode: false,
            
            // 1100 Point Goal System
            familyGoal: 1100,
            goalProgress: 0,
            goalAchieved: false,
            treats: [],
            dailyContribution: {},
            
            // Daily Check-Ins (No Points)
            morningCheckIns: {},
            eveningCheckIns: {},
            reflections: []
        };

        // ---------- CONSTANTS ----------
        const DICE_PROMPTS = [
            "üì± Send a voice note or text to a family member you haven't spoken to today",
            "ü§≤ Make dua for a family member who is far away right now",
            "üí≠ Share one thing you miss about being together during Ramadan",
            "üì∏ Send a photo of your iftar/suhoor to the family group chat",
            "üéôÔ∏è Record yourself reciting a short surah and share it with the family",
            "üåç Make dua for all the Muslims around the world fasting alone"
        ];

        const WEEKLY_QUESTS = [
            "üåü Week 1: Establish 5 family Ramadan traditions (even at a distance!)",
            "ü§ù Week 2: Contact 3 relatives or old friends you haven't spoken to",
            "üïå Week 3: Prepare for the last 10 nights - share your plans with each other",
            "üéâ Week 4: Plan a virtual Eid celebration together"
        ];

        const CHARACTER_NAMES = {
            guardian: 'The Guardian',
            seeker: 'The Seeker',
            nourisher: 'The Nourisher',
            connector: 'The Connector',
            healer: 'The Healer',
            illuminator: 'The Illuminator'
        };

        // ---------- INITIALIZATION ----------
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üåü Ramadan Legacy Quest - Remote Family Edition!");
            
            // Load saved data from localStorage
            loadGame();
            
            // Set initial family code display
            updateFamilyDisplay();
            
            // Build moon tracker
            buildMoonTracker();
            
            // Update all displays
            updateDisplay();
            updateQuestDisplay();
            updateLogDisplay();
            
            // Update goal display
            updateGoalDisplay();
            
            // Update check-in displays
            updateCheckInDisplay();
            
            // Set theme based on saved state
            if (gameState.darkMode) {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }

            // ---------- EVENT LISTENERS ----------
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('joinFamilyBtn').addEventListener('click', joinFamily);
            document.getElementById('createFamilyBtn').addEventListener('click', createFamily);
            document.getElementById('joinGameBtn').addEventListener('click', joinGame);
            document.getElementById('submitDailyBtn').addEventListener('click', submitDaily);
            document.getElementById('spotDeedBtn').addEventListener('click', spotSecretDeed);
            document.getElementById('rollDiceBtn').addEventListener('click', rollDice);
            document.getElementById('completeQuestBtn').addEventListener('click', completeQuest);
            document.getElementById('shareGameBtn').addEventListener('click', shareGame);
            document.getElementById('resetDayBtn').addEventListener('click', resetDay);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('helpBtn').addEventListener('click', toggleHelp);
            
            // Treat System Listeners
            document.getElementById('addTreatBtn').addEventListener('click', addTreat);
            document.getElementById('claimRewardBtn').addEventListener('click', claimReward);
            
            // Check-In Listeners
            document.getElementById('morningCheckInBtn').addEventListener('click', morningCheckIn);
            document.getElementById('eveningCheckInBtn').addEventListener('click', eveningCheckIn);
            document.getElementById('saveReflectionBtn').addEventListener('click', saveReflection);
            
            // Keyboard shortcut: Enter to join game
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && document.getElementById('playerName') === document.activeElement) {
                    joinGame();
                }
            });
        });

        // ---------- LOCAL STORAGE FUNCTIONS ----------
        function saveGame() {
            localStorage.setItem('ramadanLegacyQuest', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('ramadanLegacyQuest');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    gameState = {...gameState, ...parsed};
                    
                    // Initialize new properties if they don't exist
                    if (!gameState.familyGoal) gameState.familyGoal = 1100;
                    if (!gameState.goalProgress) gameState.goalProgress = 0;
                    if (!gameState.goalAchieved) gameState.goalAchieved = false;
                    if (!gameState.treats) gameState.treats = [];
                    if (!gameState.dailyContribution) gameState.dailyContribution = {};
                    
                    // Initialize check-in properties
                    if (!gameState.morningCheckIns) gameState.morningCheckIns = {};
                    if (!gameState.eveningCheckIns) gameState.eveningCheckIns = {};
                    if (!gameState.reflections) gameState.reflections = [];
                    
                } catch(e) {
                    console.log("Couldn't load saved game, starting fresh");
                }
            }
        }

        // ---------- THEME TOGGLE ----------
        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                toggle.innerHTML = '<i class="fas fa-sun"></i>';
                gameState.darkMode = true;
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                toggle.innerHTML = '<i class="fas fa-moon"></i>';
                gameState.darkMode = false;
            }
            saveGame();
        }

        // ---------- FAMILY CODE FUNCTIONS ----------
        function createFamily() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars[Math.floor(Math.random() * chars.length)];
            }
            
            gameState.familyCode = code;
            gameState.players = [];
            gameState.totalPoints = 0;
            gameState.logs = [];
            gameState.goalProgress = 0;
            gameState.goalAchieved = false;
            gameState.treats = [];
            gameState.dailyContribution = {};
            gameState.morningCheckIns = {};
            gameState.eveningCheckIns = {};
            gameState.reflections = [];
            
            updateFamilyDisplay();
            updateGoalDisplay();
            updateCheckInDisplay();
            addLog(`üè† New family created! Code: ${code}`);
            showCelebration('Family Created!', `Your family code is: ${code}`, true, 0);
            saveGame();
        }

        function joinFamily() {
            const input = document.getElementById('familyCodeInput');
            const code = input.value.trim().toUpperCase();
            
            if (code.length < 3) {
                showCelebration('Oops!', 'Please enter a valid family code', false, 0);
                return;
            }
            
            gameState.familyCode = code;
            gameState.players = [];
            gameState.totalPoints = 0;
            gameState.goalProgress = 0;
            gameState.goalAchieved = false;
            gameState.treats = [];
            gameState.dailyContribution = {};
            gameState.morningCheckIns = {};
            gameState.eveningCheckIns = {};
            gameState.reflections = [];
            
            updateFamilyDisplay();
            updateGoalDisplay();
            updateCheckInDisplay();
            addLog(`üö™ Joined family: ${code}`);
            showCelebration('Welcome!', `You joined family: ${code}`, true, 0);
            
            input.value = '';
            saveGame();
        }

        function updateFamilyDisplay() {
            const display = document.getElementById('familyCodeDisplay');
            if (gameState.familyCode) {
                display.innerHTML = `‚ú® ${gameState.familyCode} ‚ú®`;
            } else {
                display.innerHTML = 'üî¥ NOT JOINED';
            }
        }

        // ---------- GOAL PROGRESS FUNCTIONS ----------
        function updateGoalDisplay() {
            const goalProgressElement = document.getElementById('goalProgress');
            const goalProgressFill = document.getElementById('goalProgressFill');
            const goalPercentage = document.getElementById('goalPercentage');
            const goalCelebration = document.getElementById('goalCelebration');
            const treatList = document.getElementById('treatList');
            const treatCount = document.getElementById('treatCount');
            
            const progress = Math.min(gameState.totalPoints, gameState.familyGoal);
            const percentage = Math.floor((progress / gameState.familyGoal) * 100);
            
            if (goalProgressElement) {
                goalProgressElement.innerHTML = `${gameState.totalPoints} / ${gameState.familyGoal}`;
            }
            
            if (goalProgressFill) {
                goalProgressFill.style.width = `${percentage}%`;
            }
            
            if (goalPercentage) {
                goalPercentage.innerHTML = `${percentage}%`;
            }
            
            if (!gameState.goalAchieved && gameState.totalPoints >= gameState.familyGoal) {
                gameState.goalAchieved = true;
                if (goalCelebration) {
                    goalCelebration.style.display = 'block';
                }
                addLog(`üéâüéâüéâ FAMILY GOAL ACHIEVED! 1100 POINTS! üéâüéâüéâ`);
                showCelebration('GOAL COMPLETE!', 'Your family reached 1100 points! Time to celebrate!', true, 0);
                createConfetti(100);
            } else if (goalCelebration) {
                goalCelebration.style.display = gameState.goalAchieved ? 'block' : 'none';
            }
            
            if (treatList) {
                treatList.innerHTML = '';
                if (gameState.treats.length === 0) {
                    treatList.innerHTML = '<div style="padding: 15px; text-align: center; color: #8a7c6d;">‚ú® No treats added yet. Add your family\'s favorite treats! ‚ú®</div>';
                } else {
                    gameState.treats.forEach((treat) => {
                        const treatItem = document.createElement('div');
                        treatItem.className = 'treat-item';
                        treatItem.innerHTML = `
                            <span>üéÅ ${treat.name}</span>
                            <span style="color: #d4af37;">Added by: ${treat.addedBy}</span>
                        `;
                        treatList.appendChild(treatItem);
                    });
                }
            }
            
            if (treatCount) {
                treatCount.innerHTML = gameState.treats.length;
            }
        }

        // ---------- TREAT FUNCTIONS ----------
        function addTreat() {
            if (!gameState.familyCode) {
                showCelebration('Join Family', 'Please join a family first', false, 0);
                return;
            }
            
            const treatInput = document.getElementById('treatInput');
            const treatName = treatInput.value.trim();
            
            if (!treatName) {
                showCelebration('Add a Treat', 'Please enter what treat you want!', false, 0);
                return;
            }
            
            let addedBy = 'Family Member';
            if (gameState.players.length > 0) {
                addedBy = gameState.players[gameState.players.length - 1].name;
            }
            
            gameState.treats.push({
                name: treatName,
                addedBy: addedBy,
                timestamp: new Date().toISOString()
            });
            
            updateGoalDisplay();
            addLog(`üéÅ ${addedBy} added a treat: ${treatName}`);
            showCelebration('Treat Added!', `‚ú® ${treatName} ‚ú®`, true, 0);
            
            treatInput.value = '';
            saveGame();
        }

        function claimReward() {
            if (!gameState.goalAchieved) {
                showCelebration('Goal Not Reached', 'Keep going! Reach 1100 points first!', false, 0);
                return;
            }
            
            if (gameState.treats.length === 0) {
                showCelebration('No Treats Yet', 'Add some treats to claim!', false, 0);
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.treats.length);
            const claimedTreat = gameState.treats[randomIndex];
            
            gameState.treats.splice(randomIndex, 1);
            
            let claimedBy = 'Family Member';
            if (gameState.players.length > 0) {
                claimedBy = gameState.players[gameState.players.length - 1].name;
            }
            
            updateGoalDisplay();
            addLog(`üéâ ${claimedBy} claimed the treat: ${claimedTreat.name}! üéâ`);
            showCelebration('TREAT CLAIMED!', `üéÅ ${claimedTreat.name} üéÅ`, true, 50);
            
            if (gameState.players.length > 0) {
                const claimer = gameState.players[gameState.players.length - 1];
                claimer.points += 10;
                gameState.totalPoints += 10;
                updateDisplay();
            }
            
            saveGame();
        }

        // ---------- DAILY CHECK-IN FUNCTIONS ----------
        function morningCheckIn() {
            if (!gameState.familyCode) {
                showCelebration('Join Family', 'Please join a family first', false, 0);
                return;
            }
            
            if (gameState.players.length === 0) {
                showCelebration('No Players', 'Please join the game first!', false, 0);
                return;
            }
            
            const player = gameState.players[gameState.players.length - 1];
            const today = `day${gameState.currentDay}`;
            
            if (!gameState.morningCheckIns[today]) {
                gameState.morningCheckIns[today] = [];
            }
            
            if (gameState.morningCheckIns[today].includes(player.name)) {
                showCelebration('Already Checked In!', 'You already did your morning check-in today ‚òÄÔ∏è', false, 0);
                return;
            }
            
            gameState.morningCheckIns[today].push(player.name);
            
            updateCheckInDisplay();
            addLog(`‚òÄÔ∏è ${player.name} checked in for Fajr - Ramadan Mubarak!`);
            showCelebration('Morning Check-In', 'Alhamdulillah for another day of Ramadan! ‚òÄÔ∏è', false, 0);
            saveGame();
        }

        function eveningCheckIn() {
            if (!gameState.familyCode) {
                showCelebration('Join Family', 'Please join a family first', false, 0);
                return;
            }
            
            if (gameState.players.length === 0) {
                showCelebration('No Players', 'Please join the game first!', false, 0);
                return;
            }
            
            const player = gameState.players[gameState.players.length - 1];
            const today = `day${gameState.currentDay}`;
            
            if (!gameState.eveningCheckIns[today]) {
                gameState.eveningCheckIns[today] = [];
            }
            
            if (gameState.eveningCheckIns[today].includes(player.name)) {
                showCelebration('Already Checked In!', 'You already did your evening check-in today üåô', false, 0);
                return;
            }
            
            gameState.eveningCheckIns[today].push(player.name);
            
            updateCheckInDisplay();
            addLog(`üåô ${player.name} checked in for Maghrib - Iftar Mubarak!`);
            showCelebration('Evening Check-In', 'May your fast be accepted! üåô', false, 0);
            saveGame();
        }

        function saveReflection() {
            if (!gameState.familyCode) {
                showCelebration('Join Family', 'Please join a family first', false, 0);
                return;
            }
            
            const reflectionInput = document.getElementById('reflectionInput');
            const reflection = reflectionInput.value.trim();
            
            if (!reflection) {
                showCelebration('Empty Reflection', 'Please write something about your day', false, 0);
                return;
            }
            
            let playerName = 'Family Member';
            if (gameState.players.length > 0) {
                playerName = gameState.players[gameState.players.length - 1].name;
            }
            
            gameState.reflections.unshift({
                player: playerName,
                day: gameState.currentDay,
                reflection: reflection,
                timestamp: new Date().toISOString()
            });
            
            if (gameState.reflections.length > 20) {
                gameState.reflections.pop();
            }
            
            updateCheckInDisplay();
            addLog(`üí≠ ${playerName} shared a reflection: "${reflection.substring(0, 50)}${reflection.length > 50 ? '...' : ''}"`);
            showCelebration('Reflection Saved', 'JazakAllah khair for sharing! üíö', false, 0);
            
            reflectionInput.value = '';
            saveGame();
        }

        function updateCheckInDisplay() {
            const today = `day${gameState.currentDay}`;
            
            const morningCount = gameState.morningCheckIns[today]?.length || 0;
            const morningCheckInCount = document.getElementById('morningCheckInCount');
            if (morningCheckInCount) {
                morningCheckInCount.innerHTML = `${morningCount} / ${gameState.players.length}`;
            }
            
            const morningCheckInList = document.getElementById('morningCheckInList');
            if (morningCheckInList) {
                morningCheckInList.innerHTML = '';
                if (morningCount === 0) {
                    morningCheckInList.innerHTML = '<div style="padding: 10px; text-align: center; color: #8a7c6d;">üåô No morning check-ins yet</div>';
                } else {
                    gameState.morningCheckIns[today].forEach(name => {
                        const item = document.createElement('div');
                        item.style.cssText = 'padding: 8px 12px; margin: 5px 0; background: rgba(212,175,55,0.1); border-radius: 20px; display: inline-block; margin-right: 8px;';
                        item.innerHTML = `‚òÄÔ∏è ${name}`;
                        morningCheckInList.appendChild(item);
                    });
                }
            }
            
            const eveningCount = gameState.eveningCheckIns[today]?.length || 0;
            const eveningCheckInCount = document.getElementById('eveningCheckInCount');
            if (eveningCheckInCount) {
                eveningCheckInCount.innerHTML = `${eveningCount} / ${gameState.players.length}`;
            }
            
            const eveningCheckInList = document.getElementById('eveningCheckInList');
            if (eveningCheckInList) {
                eveningCheckInList.innerHTML = '';
                if (eveningCount === 0) {
                    eveningCheckInList.innerHTML = '<div style="padding: 10px; text-align: center; color: #8a7c6d;">üåô No evening check-ins yet</div>';
                } else {
                    gameState.eveningCheckIns[today].forEach(name => {
                        const item = document.createElement('div');
                        item.style.cssText = 'padding: 8px 12px; margin: 5px 0; background: rgba(212,175,55,0.1); border-radius: 20px; display: inline-block; margin-right: 8px;';
                        item.innerHTML = `üåô ${name}`;
                        eveningCheckInList.appendChild(item);
                    });
                }
            }
            
            const reflectionsList = document.getElementById('reflectionsList');
            if (reflectionsList) {
                reflectionsList.innerHTML = '';
                if (gameState.reflections.length === 0) {
                    reflectionsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #8a7c6d;">üí≠ No reflections yet. Share your Ramadan thoughts!</div>';
                } else {
                    gameState.reflections.slice(0, 10).forEach(ref => {
                        const reflectionCard = document.createElement('div');
                        reflectionCard.style.cssText = 'padding: 15px; margin: 10px 0; background: rgba(126,159,111,0.1); border-radius: 20px; border-left: 4px solid #d4af37;';
                        reflectionCard.innerHTML = `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: bold; color: #7d9a6c;">${ref.player}</span>
                                <span style="color: #d4af37; font-size: 0.9rem;">Day ${ref.day}</span>
                            </div>
                            <p style="font-style: italic;">"${ref.reflection}"</p>
                        `;
                        reflectionsList.appendChild(reflectionCard);
                    });
                }
            }
        }

        // ---------- MOON TRACKER ----------
        function buildMoonTracker() {
            const tracker = document.getElementById('moonTracker');
            tracker.innerHTML = '';
            
            for (let i = 1; i <= 30; i++) {
                const moon = document.createElement('div');
                moon.className = 'moon-day';
                moon.textContent = i;
                
                if (i === gameState.currentDay) {
                    moon.classList.add('current');
                } else if (i < gameState.currentDay) {
                    moon.classList.add('completed');
                }
                
                moon.addEventListener('click', function() {
                    gameState.currentDay = i;
                    buildMoonTracker();
                    updateDisplay();
                    updateCheckInDisplay();
                    addLog(`üìÖ Day changed to ${i}`);
                    saveGame();
                });
                
                tracker.appendChild(moon);
            }
        }

        // ---------- PLAYER FUNCTIONS ----------
        function joinGame() {
            if (!gameState.familyCode) {
                showCelebration('Family Required!', 'Please create or join a family first', false, 0);
                return;
            }
            
            const name = document.getElementById('playerName').value.trim();
            const character = document.getElementById('characterSelect').value;
            
            if (!name) {
                showCelebration('Enter Name', 'Please enter your name', false, 0);
                return;
            }
            
            if (!character) {
                showCelebration('Choose Role', 'Please select a character', false, 0);
                return;
            }
            
            if (gameState.players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                showCelebration('Welcome Back!', `${name} is already playing`, true, 0);
                return;
            }
            
            const player = {
                id: Date.now(),
                name: name,
                character: character,
                points: 0,
                todayPoints: 0,
                joinedDay: gameState.currentDay,
                totalContribution: 0
            };
            
            gameState.players.push(player);
            saveGame();
            
            updateDisplay();
            updateCheckInDisplay();
            addLog(`‚ú® ${name} joined as ${CHARACTER_NAMES[character]}`);
            showCelebration('Welcome!', `${name} joined the quest!`, true, 0);
            
            document.getElementById('playerName').value = '';
            document.getElementById('characterSelect').selectedIndex = 0;
        }

        // ---------- DAILY SUBMISSION ----------
        function submitDaily() {
            if (!gameState.familyCode) {
                showCelebration('Join Family', 'Please join a family first', false, 0);
                return;
            }
            
            if (gameState.players.length === 0) {
                showCelebration('No Players', 'Join the game first!', false, 0);
                return;
            }

            const player = gameState.players[gameState.players.length - 1];
            
            const fastPoints = parseInt(document.getElementById('fastSelect').value);
            const quranPoints = parseInt(document.getElementById('quranSelect').value);
            const prayerPoints = parseInt(document.getElementById('prayerSelect').value);
            const missionPoints = parseInt(document.getElementById('missionSelect').value);
            
            const total = fastPoints + quranPoints + prayerPoints + missionPoints;
            
            if (total === 0) {
                showCelebration('No Points Yet', 'Every small step counts!', false, 0);
                return;
            }
            
            player.points += total;
            player.todayPoints = total;
            player.totalContribution = (player.totalContribution || 0) + total;
            
            gameState.totalPoints += total;
            
            const today = `day${gameState.currentDay}`;
            if (!gameState.dailyContribution[today]) {
                gameState.dailyContribution[today] = 0;
            }
            gameState.dailyContribution[today] += total;
            
            saveGame();
            updateDisplay();
            updateGoalDisplay();
            
            const remaining = gameState.familyGoal - gameState.totalPoints;
            if (remaining > 0 && remaining <= 100) {
                addLog(`üéØ Only ${remaining} points until family goal!`);
            }
            
            addLog(`üìä ${player.name} earned ${total} points`);
            showCelebration('Points Added!', `+${total} points for ${player.name}`, true, total);
            
            document.getElementById('fastSelect').selectedIndex = 0;
            document.getElementById('quranSelect').selectedIndex = 0;
            document.getElementById('prayerSelect').selectedIndex = 0;
            document.getElementById('missionSelect').selectedIndex = 0;
        }

        // ---------- SECRET DEED ----------
        function spotSecretDeed() {
            if (gameState.players.length < 2) {
                showCelebration('Need 2 Players', 'Secret deeds need at least 2 players', false, 0);
                return;
            }
            
            const spotter = gameState.players[gameState.players.length - 1];
            const otherPlayers = gameState.players.filter(p => p.id !== spotter.id);
            const spotted = otherPlayers[Math.floor(Math.random() * otherPlayers.length)];
            
            spotter.points += 2;
            spotted.points += 3;
            gameState.totalPoints += 5;
            
            spotter.totalContribution = (spotter.totalContribution || 0) + 2;
            spotted.totalContribution = (spotted.totalContribution || 0) + 3;
            
            saveGame();
            updateDisplay();
            updateGoalDisplay();
            addLog(`üëÄ ${spotter.name} spotted ${spotted.name}'s secret deed! +5 family points`);
            showCelebration('Secret Deed!', `${spotter.name} spotted ${spotted.name}'s kindness! +5`, true, 5);
        }

        // ---------- DUA DICE ----------
        function rollDice() {
            const roll = Math.floor(Math.random() * 6);
            const prompt = DICE_PROMPTS[roll];
            
            document.getElementById('diceResult').innerHTML = `
                <div style="text-align: center;">
                    <span style="font-size: 3rem; display: block; margin-bottom: 10px;">üé≤ ${roll+1}</span>
                    <span style="font-size: 1.3rem;">${prompt}</span>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #d4af37;">
                        <i class="fas fa-heart"></i> Connect with your family today!
                    </div>
                </div>
            `;
            
            addLog(`üé≤ Dua Dice rolled: "${prompt}"`);
            
            if (gameState.players.length > 0) {
                gameState.players.forEach(p => {
                    p.points += 1;
                    p.totalContribution = (p.totalContribution || 0) + 1;
                });
                gameState.totalPoints += gameState.players.length;
                saveGame();
                updateDisplay();
                updateGoalDisplay();
            }
        }

        // ---------- WEEKLY QUEST ----------
        function completeQuest() {
            if (gameState.weeklyQuest > 4) {
                showCelebration('All Quests Done!', 'You completed all weekly quests!', true, 0);
                return;
            }
            
            if (gameState.players.length === 0) {
                showCelebration('No Players', 'Join with a character first', false, 0);
                return;
            }
            
            const bonus = gameState.weeklyQuest * 5;
            
            gameState.players.forEach(p => {
                p.points += bonus;
                p.totalContribution = (p.totalContribution || 0) + bonus;
            });
            
            gameState.totalPoints += (bonus * gameState.players.length);
            
            addLog(`üèÜ Weekly Quest ${gameState.weeklyQuest} completed! +${bonus} each!`);
            showCelebration('Quest Complete!', `Week ${gameState.weeklyQuest} done! +${bonus} points each!`, true, bonus * gameState.players.length);
            
            gameState.weeklyQuest++;
            if (gameState.weeklyQuest > 4) gameState.weeklyQuest = 4;
            
            saveGame();
            updateDisplay();
            updateQuestDisplay();
            updateGoalDisplay();
        }

        // ---------- UPDATE DISPLAYS ----------
        function updateDisplay() {
            document.getElementById('currentDay').innerHTML = `Day ${gameState.currentDay} of Ramadan`;
            document.getElementById('totalPoints').innerHTML = gameState.totalPoints;
            
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            
            if (gameState.players.length === 0) {
                playerList.innerHTML = `
                    <div class="player">
                        <div><strong>‚ú® Awaiting Heroes ‚ú®</strong><br><small>Join to begin</small></div>
                        <div class="player-points">0</div>
                    </div>
                `;
                return;
            }
            
            gameState.players.sort((a, b) => b.points - a.points);
            
            gameState.players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'player';
                div.innerHTML = `
                    <div>
                        <strong>${player.name}</strong><br>
                        <small style="color: #7d9a6c;">${CHARACTER_NAMES[player.character]}</small>
                        <br><small style="color: #d4af37;">Total contributed: ${player.totalContribution || 0} pts</small>
                    </div>
                    <div class="player-points">${player.points}</div>
                `;
                playerList.appendChild(div);
            });
        }

        function updateQuestDisplay() {
            const idx = Math.min(gameState.weeklyQuest - 1, 3);
            document.getElementById('currentQuest').innerHTML = `‚ú® ${WEEKLY_QUESTS[idx]} ‚ú®`;
        }

        // ---------- LOG SYSTEM ----------
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
            gameState.logs.unshift(`[${timestamp}] ${message}`);
            
            if (gameState.logs.length > 25) gameState.logs.pop();
            
            updateLogDisplay();
            saveGame();
        }

        function updateLogDisplay() {
            const logDiv = document.getElementById('familyLog');
            logDiv.innerHTML = '';
            
            if (gameState.logs.length === 0) {
                logDiv.innerHTML = '<div class="log-entry"><i class="fas fa-star" style="color: #d4af37;"></i> Welcome to Ramadan Legacy Quest!</div>';
                return;
            }
            
            gameState.logs.forEach(log => {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `<i class="fas fa-circle" style="font-size: 0.6rem; color: #d4af37;"></i> ${log}`;
                logDiv.appendChild(entry);
            });
        }

        // ---------- CELEBRATION MODAL ----------
        function showCelebration(title, message, withConfetti = true, points = 0) {
            document.getElementById('modalTitle').innerHTML = `‚ú® ${title} ‚ú®`;
            document.getElementById('modalMessage').innerHTML = points > 0 
                ? `${message}<br><span style="font-size: 2rem; color: #d4af37;">+${points} points!</span>` 
                : message;
            
            document.getElementById('celebrationModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
            
            if (withConfetti) createConfetti(40);
            
            setTimeout(closeModal, 3000);
        }

        function closeModal() {
            document.getElementById('celebrationModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        // ---------- CONFETTI ----------
        function createConfetti(count = 40) {
            for (let i = 0; i < count; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti-piece';
                conf.style.left = Math.random() * 100 + '%';
                conf.style.animation = `fall ${Math.random() * 2 + 2}s linear forwards`;
                conf.style.background = `hsl(${Math.random() * 60 + 40}, 80%, 60%)`;
                conf.style.width = Math.random() * 12 + 8 + 'px';
                conf.style.height = conf.style.width;
                
                document.body.appendChild(conf);
                
                setTimeout(() => conf.remove(), 4000);
            }
        }

        // ---------- UTILITY FUNCTIONS ----------
        function shareGame() {
            if (navigator.share) {
                navigator.share({
                    title: 'Ramadan Legacy Quest',
                    text: `Join our family quest! Family code: ${gameState.familyCode || 'Create one!'} - We're aiming for 1100 points together!`,
                    url: window.location.href,
                }).catch(() => {});
            } else {
                navigator.clipboard.writeText(window.location.href);
                showCelebration('Link Copied!', 'Share with your family!', true, 0);
            }
        }

        function resetDay() {
            if (gameState.currentDay < 30) {
                gameState.currentDay++;
                buildMoonTracker();
                updateDisplay();
                updateCheckInDisplay();
                addLog(`üåô Day ${gameState.currentDay} begins`);
                showCelebration('New Day', `Welcome to Day ${gameState.currentDay}`, true, 0);
                saveGame();
            } else {
                showCelebration('Ramadan Complete!', 'You\'ve completed 30 days! üéâ', true, 0);
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(gameState, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ramadan-quest-${gameState.familyCode || 'family'}-day-${gameState.currentDay}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            addLog('üíæ Game progress exported');
            showCelebration('Saved!', 'Your progress has been saved', true, 0);
        }

        function toggleHelp() {
            showCelebration(
                'How to Play', 
                '1Ô∏è‚É£ Create/Join a family\n2Ô∏è‚É£ Choose character\n3Ô∏è‚É£ Log daily worship (earn points!)\n4Ô∏è‚É£ Roll Dua Dice - connect remotely!\n5Ô∏è‚É£ Complete quests!\n\n‚òÄÔ∏èüåô Daily Check-Ins (No points) - Build consistency!\nüí≠ Share reflections with family\n\nüéØ FAMILY GOAL: 1100 POINTS!\nAdd treats and claim rewards when goal is reached!',
                false, 
                0
            );
        }
    </script>
</body>
</html>
